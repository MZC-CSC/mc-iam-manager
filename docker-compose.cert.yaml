networks:
  mcmp-cert-network:

services:

  # Certbot (인증서 발급 및 갱신용)
  # 이 컨테이너는 필요할 때만 1회성으로 실행됩니다.
  mcmp-certbot:
    image: certbot/certbot:latest
    container_name: mcmp-certbot
    volumes:
      # Certbot 설정 및 발급된 인증서 저장 (읽기/쓰기 권한 필요)
      - ./dockercontainer-volume/certs:/etc/letsencrypt
      # Certbot 웹루트 챌린지 파일 저장 (Nginx와 공유)
      - ./dockercontainer-volume/certbot/www:/var/www/certbot
    environment:
      DOMAIN_NAME: ${DOMAIN_NAME:-localhost}
      EMAIL: ${EMAIL:-admin@example.com}
    entrypoint: ["certbot"] # Certbot 실행 명령을 엔트리포인트로 지정
    #command: ["certonly", "--webroot", "--webroot-path=/var/www/certbot", "--email", "$EMAIL", "--agree-tos", "--no-eff-email", "-d", "$DOMAIN_NAME", "--non-interactive", "--staging"] # <-- 초기 발급 테스트 시 --staging 사용, 실제 발급 시 제거
    #command: ["certonly", "--webroot", "--webroot-path=/var/www/certbot", "--email", "$EMAIL", "--agree-tos", "--no-eff-email", "-d", "$DOMAIN_NAME", "--non-interactive"] # <-- 실제발급
    command: ["certonly", "--webroot", "--webroot-path=/var/www/certbot", "--email", "$EMAIL", "--agree-tos", "--no-eff-email", "-d", "$DOMAIN_NAME", "--non-interactive", "--force-renewal"] # <-- 강제 재발급
    